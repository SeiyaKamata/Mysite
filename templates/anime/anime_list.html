{% extends 'base.html' %}
{% load static %}

{% block css %}
<link rel="stylesheet" href="{% static 'css/anime_list.css' %}">
{% endblock %}

{% block content %}
<div class="d-flex justify-content-end mb-3">
  <a href="add" type="button" class="btn btn-primary">追加</a>
</div>
<div class="d-flex justify-content-end mb-5">
  <div class="col-3">
    <select id="periodSelect" class="form-select" aria-label="Default select example">
      <option selected value="">Period</option>
      {% for p in period %}
      {% if p.id == selected_period %}
      <option value="{{ p.id }}" selected>{{ p }}</option>
      {% else %}
      <option value="{{ p.id }}">{{ p }}</option>
      {% endif %}
      {% endfor %}
    </select>
  </div>

  <div class="col-3">
    <select id="genreSelect" class="form-select" aria-label="Default select example">
      <option selected value="">Genre</option>
      {% for g in genre %}
      {% if g.id == selected_genre %}
      <option value="{{ g.id }}" selected>{{ g }}</option>
      {% else %}
      <option value="{{ g.id }}">{{ g }}</option>
      {% endif %}
      {% endfor %}
    </select>
  </div>
</div>

<div id="anime-list" class="d-flex flex-wrap justify-content-between">
  {% for anime in anime_list %}
  <div class="image-box">
    <a href="detail?id={{anime.id}}">
      <div class="image-container">
        <img src="{{anime.image}}" alt="Your Image">
      </div>
    </a>
  </div>
  {% endfor %}
</div>
{% endblock %}

{% block script %}
<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>

<script>

  $(document).ready(function () {
    $('#genreSelect, #periodSelect').change(function () {
      filterAnime();
    });

    function filterAnime() {
      var selectedGenre = $('#genreSelect').val();
      var selectedPeriod = $('#periodSelect').val();

      $.ajax({
        url: 'anime_list_api/',
        method: 'GET',
        data: { genre: selectedGenre, period: selectedPeriod },
        success: function (data) {
          updateAnimeList(data.anime_list);
        },
        error: function (error) {
          console.error('Error:', error);
        }
      });
    }

    function updateAnimeList(animeList) {
      $('#anime-list').empty();

      animeList.forEach(function (anime) {
        var cardHtml = `
          <div class="image-box">
            <a href="detail?id=${anime.id}">
              <div class="image-container">
                <img src="${anime.image}" alt="Your Image">
              </div>
            </a>
          </div>
        `;

        $('#anime-list').append(cardHtml);
      });
    }
  });
</script>
{% endblock %}